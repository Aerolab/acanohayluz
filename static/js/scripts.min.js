var cookies=(function(){var e,d,c,b,a={expiresAt:null,path:"/",domain:null,secure:false};e=function(g){var h,f;if(typeof g!=="object"||g===null){h=a}else{h={expiresAt:a.expiresAt,path:a.path,domain:a.domain,secure:a.secure};if(typeof g.expiresAt==="object"&&g.expiresAt instanceof Date){h.expiresAt=g.expiresAt}else{if(typeof g.hoursToLive==="number"&&g.hoursToLive!==0){f=new Date();f.setTime(f.getTime()+(g.hoursToLive*60*60*1000));h.expiresAt=f}}if(typeof g.path==="string"&&g.path!==""){h.path=g.path}if(typeof g.domain==="string"&&g.domain!==""){h.domain=g.domain}if(g.secure===true){h.secure=g.secure}}return h};d=function(f){f=e(f);return((typeof f.expiresAt==="object"&&f.expiresAt instanceof Date?"; expires="+f.expiresAt.toGMTString():"")+"; path="+f.path+(typeof f.domain==="string"?"; domain="+f.domain:"")+(f.secure===true?"; secure":""))};c=function(){var o={},h,g,f,n,k=document.cookie.split(";"),j;for(h=0;h<k.length;h=h+1){g=k[h].split("=");f=g[0].replace(/^\s*/,"").replace(/\s*$/,"");try{n=decodeURIComponent(g[1])}catch(m){n=g[1]}if(typeof JSON==="object"&&JSON!==null&&typeof JSON.parse==="function"){try{j=n;n=JSON.parse(n)}catch(l){n=j}}o[f]=n}return o};b=function(){};b.prototype.get=function(j){var f,h,g=c();if(typeof j==="string"){f=(typeof g[j]!=="undefined")?g[j]:null}else{if(typeof j==="object"&&j!==null){f={};for(h in j){if(typeof g[j[h]]!=="undefined"){f[j[h]]=g[j[h]]}else{f[j[h]]=null}}}else{f=g}}return f};b.prototype.filter=function(f){var j,g={},h=c();if(typeof f==="string"){f=new RegExp(f)}for(j in h){if(j.match(f)){g[j]=h[j]}}return g};b.prototype.set=function(j,g,f){if(typeof f!=="object"||f===null){f={}}if(typeof g==="undefined"||g===null){g="";f.hoursToLive=-8760}else{if(typeof g!=="string"){if(typeof JSON==="object"&&JSON!==null&&typeof JSON.stringify==="function"){g=JSON.stringify(g)}else{throw new Error("cookies.set() received non-string value and could not serialize.")}}}var h=d(f);document.cookie=j+"="+encodeURIComponent(g)+h};b.prototype.del=function(j,h){var f={},g;if(typeof h!=="object"||h===null){h={}}if(typeof j==="boolean"&&j===true){f=this.get()}else{if(typeof j==="string"){f[j]=true}}for(g in f){if(typeof g==="string"&&g!==""){this.set(g,null,h)}}};b.prototype.test=function(){var g=false,f="cT",h="data";this.set(f,h);if(this.get(f)===h){this.del(f);g=true}return g};b.prototype.setOptions=function(f){if(typeof f!=="object"){f=null}a=e(f)};return new b()})();var map,geocoder;var markers={},markerTooltip;var autocomplete,sugerenciaMarker;var MAP_MIN_ZOOM=11;var MAP_MAX_ZOOM=16;var MAX_TILE_LEVEL=14;var MIN_ZOOM_MARKERS=15;var mapaPanControl=true;var session_timestamp=Math.floor(((new Date()*1)/1000)/60);function is_mobile(){var a=false;(function(b){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))){a=true}})(navigator.userAgent||navigator.vendor||window.opera);return a||($(window).width()<=768)}function has_transitions(){var a=document.body.style;if((a.MozTransition==""||a.WebkitTransition==""||a.OTransition==""||a.transition=="")&&(a.MozTransform==""||a.WebkitTransform==""||a.OTransform==""||a.transform=="")){return true}else{return false}}$(document).ready(function(){if(!has_transitions()){$("body").addClass("without-transitions")}if(cookies.get("__d__")==null){var a=generateRandomToken(20)+((new Date())*1);cookies.set("__d__",a,{path:"/",expiresAt:(new Date(2038,0,1)),secure:false})}$("#reportar input[name=d]").val(cookies.get("__d__"));if(typeof JSON.stringify=="function"){$("#reportar input[name=f]").val(JSON.stringify(fingerprint()))}});function long2tile(a,b){return(Math.floor((a+180)/360*Math.pow(2,b)))}function lat2tile(a,b){return(Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,b)))}function get_tiles_visibles(f){if(typeof map=="undefined"){return}var a=map.getBounds();var j=[a.getSouthWest().lng(),a.getSouthWest().lat()];var c=[a.getNorthEast().lng(),a.getNorthEast().lat()];var d=long2tile(j[0],f);var b=long2tile(c[0],f);var e=lat2tile(c[1],f);var l=lat2tile(j[1],f);var k=[];for(var h=d;h<=b;h++){for(var g=e;g<=l;g++){k.push({x:h,y:g,z:f})}}return k}function generateRandomToken(a){if(typeof a!="number"||a<=0){return""}var c="";for(var b=1;b<=Math.ceil(a/16);b++){c+=Math.random().toString(36).slice(2)}return c.slice(0,a)}function fingerprint(){var b={};if(typeof screen.width=="number"&&typeof screen.height=="number"){b.r=(screen.width).toString()+"x"+(screen.height.toString());if(typeof screen.pixelDepth=="number"){b.r=b.r+"@"+(screen.pixelDepth).toString()}if(typeof window.devicePixelRatio=="number"){b.r=b.r+"#"+(window.devicePixelRatio).toString()}}b.p=[];if(typeof navigator.plugins!="undefined"){for(var a in navigator.plugins){if(typeof navigator.plugins[a]["description"]!="undefined"&&navigator.plugins[a]["description"]!=null){b.p.push(navigator.plugins[a]["description"])}else{b.p.push("__"+navigator.plugins[a]["name"]+"__"+navigator.plugins[a]["filename"])}}}b.m=[];if((document.documentElement.className).indexOf("shitty-browser")==-1){if(typeof navigator.mimeTypes!="undefined"){for(var a in navigator.mimeTypes){b.m.push(navigator.mimeTypes[a]["type"])}}}b.u=(typeof navigator.userAgent!="undefined")?navigator.userAgent:null;b.o=(typeof navigator.platform!="undefined")?navigator.platform:null;b.b=(typeof navigator.product!="undefined")?navigator.product:null;b.l=(typeof navigator.language!="undefined")?navigator.language:null;b.j=(typeof navigator.javaEnabled=="function")?navigator.javaEnabled():null;b.t=(typeof navigator.doNotTrack!="undefined")?navigator.doNotTrack:null;b.f=getFlashVersion();return b}function getFlashVersion(){try{try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{a.AllowScriptAccess="always"}catch(b){return"6,0,0"}}catch(b){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(b){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}}catch(b){}}return"0,0,0"}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")};var STR_PAD_LEFT=1;var STR_PAD_RIGHT=2;var STR_PAD_BOTH=3;function pad(f,a,e,b){f=(f).toString();if(typeof(a)=="undefined"){var a=0}if(typeof(e)=="undefined"){var e=" "}if(typeof(b)=="undefined"){var b=STR_PAD_RIGHT}if(a+1>=f.length){switch(b){case STR_PAD_LEFT:f=Array(a+1-f.length).join(e)+f;break;case STR_PAD_BOTH:var c=Math.ceil((padlen=a-f.length)/2);var d=padlen-c;f=Array(d+1).join(e)+f+Array(c+1).join(e);break;default:f=f+Array(a+1-f.length).join(e);break}}return f}function geolocationEnabled(){if(navigator.geolocation){return true}else{return false}}function getLocation(){if(geolocationEnabled()){navigator.geolocation.getCurrentPosition(getAddress,locationError)}}function getAddress(a){var d=a.coords.latitude;var b=a.coords.longitude;var e=new google.maps.LatLng(d,b);var c=new google.maps.Geocoder();c.geocode({latLng:e},function(g,f){if(f==google.maps.GeocoderStatus.OK){if(g[0]){g[0].adr_address=splitAddress(g[0].formatted_address);seleccionarDireccion(g[0])}else{$("#reportar .buscar-location").removeClass("buscando")}}else{$("#reportar .buscar-location").removeClass("buscando")}})}function locationError(a){$("#reportar .buscar-location").removeClass("buscando");switch(a.code){case a.PERMISSION_DENIED:mostrar_error("Debes autorizar el uso de tu ubicacion");break;case a.POSITION_UNAVAILABLE:mostrar_error("Tu ubicacion no esta disponible");break;case a.TIMEOUT:mostrar_error("Tu ubicacion no esta disponible");break;case a.UNKNOWN_ERROR:mostrar_error("Tu ubicacion no esta disponible");break}}function splitAddress(a){var d=a.split(",");for(var c in d){if(c==0){var b='<span class="street-address">'+d[c].trim()+"</span>, "}else{if((d.length-1)==c){b+="<span>"+d[c].trim()+"</span>"}else{b+="<span>"+d[c].trim()+"</span>, "}}}return b}function parseAddress(e){var a={},d={},c;a.street_address="";for(i in e){if(e[i].types[0]=="route"){d.street_name=e[i].long_name}if(e[i].types[0]=="street_number"){d.street_number=e[i].long_name}if(e[i].types[0]=="locality"){a.locality=e[i].long_name}if(e[i].types[0]=="administrative_area_level_1"){a.region=e[i].long_name}if(e[i].types[0]=="country"){a.country=e[i].long_name}}if(d.street_name){a.street_address=d.street_name;if(d.street_number){a.street_address+=" "+d.street_number}}for(var b in a){if(a[b]!="undefined"&&a[b]!=""){c+='<span class="'+b+'">'+a[b]+"</span> "}}return c}function setup_selector_zona(){$("#ubicacion .seleccionada").click(function(c){c.preventDefault();$("#ubicacion").toggleClass("open")});$("#ubicacion ul.opciones").html("");var b="";for(var a in ZONAS_SELECCIONABLES){b+='<li data-slug="'+ZONAS_SELECCIONABLES[a].slug+'">'+ZONAS_SELECCIONABLES[a].nombre+"</li>"}$("#ubicacion ul.opciones").html(b);$("#ubicacion ul.opciones li").click(function(e){e.preventDefault();var c=ZONAS_SELECCIONABLES[$(this).data("slug")];$("#ubicacion .seleccionada").text(c.nombre);$("#ubicacion").removeClass("open");var d=new google.maps.LatLngBounds();d.extend(new google.maps.LatLng(c.bounds.sw[1],c.bounds.sw[0]));d.extend(new google.maps.LatLng(c.bounds.ne[1],c.bounds.ne[0]));map.fitBounds(d);ga("send","event","actividad","ver_zona",c.nombre)});$("#ubicacion ul.opciones li:first-child").trigger("click");$("#ubicacion").show()}function setup_form(){$("#direccion .ubicacion .cerrar").click(function(a){a.preventDefault();$("#direccion input").val("").focus();$("#direccion").removeClass("found");$("#reportar input[name=direccion_completa]").val("");$("#reportar input[name=direccion_id]").val("");$("#reportar input[name=zona_nombre]").val("");$("#reportar input[name=lat]").val("");$("#reportar input[name=long]").val("");$("#reportar input[name=zona_id]").val("")});$("#reportar form").submit(function(a){a.preventDefault();return false});if($("html").hasClass("shitty-browser")){$("#reportar label.estado-luz").click(function(a){a.preventDefault();$("#"+$(this).attr("for")).click().change()})}$("#reportar input[type=radio]").change(function(a){$("#reportar input[type=radio]").each(function(){if($(this).is(":checked")){$(this).parent().addClass("active")}else{$(this).parent().removeClass("active")}})}).trigger("change");$("#reportar input, #reportar select, #reportar textarea").bind("change keyup",function(a){validar_form()});$("#reportar button").click(function(c){c.preventDefault();validar_form();if(!$(this).hasClass("disabled")){$("#reportar form").hide();$("#reportar .box-gracias").show();$.post("/ajax.php?m=nuevo",$("#reportar form").serialize(),function(e,g){if(e.zona["id"]!==null&&parseInt(e.zona["id"])>0){d=e.zona["nombre"]}else{var d="casa"}var f=$("#reportar input[name=estado]:checked").val();if(f=="hay-luz"){$(".box-social .facebook").attr("href","http://www.facebook.com/sharer/sharer.php?s=100&p[url]=http://acanohayluz.com.ar&p[images][0]=http://acanohayluz.com.ar/static/icons/facebook-share.png&p[title]=Volvió la luz en "+d+"!&p[summary]=Mirá dónde más volvió en http://acanohayluz.com.ar %23AcaNoHayLuz");$(".box-social .twitter").attr("href","https://twitter.com/intent/tweet?original_referer=http%3A%2F%2Facanohayluz.com.ar%2F&text=Volvió la luz en "+d+"! Mirá dónde más volvió en http://acanohayluz.com.ar %23AcaNoHayLuz")}else{$(".box-social .facebook").attr("href","http://www.facebook.com/sharer/sharer.php?s=100&p[url]=http://acanohayluz.com.ar&p[images][0]=http://acanohayluz.com.ar/static/icons/facebook-share.png&p[title]=Estoy en "+d+" y %23AcaNoHayLuz&p[summary]=Mirá dónde más no hay en http://acanohayluz.com.ar");$(".box-social .twitter").attr("href","https://twitter.com/intent/tweet?original_referer=http%3A%2F%2Facanohayluz.com.ar%2F&text=Estoy en "+d+" y %23AcaNoHayLuz. Mirá dónde más se cortó la luz en http://acanohayluz.com.ar")}},"json");var b=new Date();var a={expiresAt:(new Date()).setDate(b.getDate()+1)};cookies.set("fecha_enviado",new Date()*1,a);cookies.set("estado_enviado",$("#reportar input[name=estado]:checked").val(),a);cookies.set("lat_enviado",$("#reportar input[name=lat]").val(),a);cookies.set("long_enviado",$("#reportar input[name=long]").val(),a);ga("send","event","actividad","reporte",{zona:nombre_zona,estado:estado})}});$("#reportar .buscar-location").on("click",function(a){a.preventDefault();$("#reportar .buscar-location").addClass("buscando");getLocation()})}function validar_form(){var a=false;if($("#reportar input[name=direccion_completa]").val()==""){a=true}if($("#reportar input[name=estado]:checked").val()=="hay-luz"){$("#reportar .adicional.horas").hide()}else{$("#reportar .adicional.horas").show();if(!(parseInt($("#reportar input[name=horas]").val())>=0)){a=true}}var b=$("#reportar input[name=estado]:checked").val();if(typeof sugerenciaMarker!="undefined"){sugerenciaMarker.setIcon({url:STATIC_URL+"css/images/reporte-"+b+".png",animation:google.maps.Animation.DROP,scaledSize:new google.maps.Size(35,53),anchor:new google.maps.Point(18,53),origin:new google.maps.Point(0,0),size:new google.maps.Size(35,53)})}$("#reportar button").attr("class","btn");if(!a){$("#reportar button").addClass(b);switch(b){case"hay-luz":$("#reportar button").text("Avisar que Hay Luz");break;case"corte-cuadra":$("#reportar button").text("Denunciar Corte de Luz");break;case"corte-amplio":$("#reportar button").text("Denunciar Apagón");break}}else{$("#reportar button").addClass("disabled").text("Completa el formulario")}}function setup_autocomplete(){if(typeof autocomplete!="undefined"){return}autocomplete=new google.maps.places.Autocomplete($("#direccion input[name=direccion]")[0],{types:["geocode"]});autocomplete.setComponentRestrictions({country:"ar"});$("#direccion input[name=direccion]").blur(function(a){setTimeout(function(){if($("#reportar input[name=direccion_completa]").val()==""){$("#direccion .error").text("Por favor, elegí una dirección.").show()}else{$("#direccion .error").hide()}},300)});google.maps.event.addListener(autocomplete,"place_changed",function(){if(typeof sugerenciaMarker!="undefined"){sugerenciaMarker.setVisible(false)}var a=autocomplete.getPlace();if(typeof a=="undefined"||!a.geometry){return}seleccionarDireccion(a)});if(is_mobile()){$("#reportar .buscar-location").show()}}function mostrar_error(a){$("#direccion .error").text(a).show();setTimeout(function(){$("#direccion .error").hide()},3000)}function init_mapa(){if(typeof map!="undefined"){return}$("#mapa").attr("class","").addClass("barrios-no-visibles");var b={center:new google.maps.LatLng(-34.6033,-58.4317),zoom:13,minZoom:MAP_MIN_ZOOM,maxZoom:MAP_MAX_ZOOM,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,panControl:(typeof mapaPanControl=="undefined"||!mapaPanControl)?false:true,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:true,scaleControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:false};var c=new google.maps.StyledMapType([{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],{name:"AcaNoHayLuzMap"});map=new google.maps.Map(document.getElementById("mapa"),b);map.mapTypes.set("map_style_simple",c);map.setMapTypeId("map_style_simple");setup_selector_zona();sugerenciaMarker=new google.maps.Marker({map:map,zIndex:9999});sugerenciaMarker.setVisible(false);google.maps.event.addListener(map,"bounds_changed",function(){if(map.zoom>=13){$("#mapa").attr("class","").addClass("barrios-visibles").addClass("zoom-"+map.zoom)}else{$("#mapa").attr("class","").addClass("barrios-no-visibles")}});markerTooltip=new google.maps.InfoWindow({content:"",pixelOffset:new google.maps.Size(-10,0)});var a=is_mobile();google.maps.event.addListener(map,"bounds_changed",function(){if(map.zoom<MIN_ZOOM_MARKERS){hide_markers()}else{show_markers()}clearTimeout(markers_timeout);markers_timeout=setTimeout(function(){update_markers(a)},a?600:300)});dibujar_zonas()}function seleccionarDireccion(a){$("#direccion").addClass("found");$("#direccion .ubicacion .lugar").html(a.adr_address);$("#reportar input[name=direccion_completa]").val(a.formatted_address);for(var b in a.address_components){if($.inArray("neighborhood",a.address_components[b].types)>=0){$("#reportar input[name=zona_nombre]").val(a.address_components[b].long_name);break}else{if($.inArray("locality",a.address_components[b].types)>=0){$("#reportar input[name=zona_nombre]").val(a.address_components[b].long_name);break}}}$("#reportar input[name=direccion_id]").val(a.id);$("#reportar input[name=lat]").val(a.geometry.location.lat());$("#reportar input[name=long]").val(a.geometry.location.lng());$("#reportar .suministro input").focus();validar_form();$("#reportar .buscar-location").removeClass("buscando");map.setZoom(17);map.panTo(a.geometry.location);sugerenciaMarker.setPosition(a.geometry.location);sugerenciaMarker.setVisible(true)}function dibujar_zonas(){var a=Math.floor((new Date()*1)/1000/60/5);var e=14;var d=new google.maps.ImageMapType({minZoom:MAP_MIN_ZOOM,maxZoom:MAP_MAX_ZOOM,getTileUrl:function(k,j){if(j>e||j<this.minZoom){return null}if(typeof TILES[j]=="undefined"||typeof TILES[j][k.x]=="undefined"||typeof TILES[j][k.x][k.y]=="undefined"){return null}return[STATIC_URL,"tiles/acanohayluz-",j,"-",k.x,"-",k.y,".png?",TILES[j][k.x][k.y]].join("")},tileSize:new google.maps.Size(256,256)});map.overlayMapTypes.push(d);for(var c=e+1;c<=MAP_MAX_ZOOM;c++){var h=Math.pow(2,(c-e));var g=256*h;var f=new google.maps.ImageMapType({minZoom:c,maxZoom:c,getTileUrl:function(k,j){if(j!=this.minZoom){return null}if(typeof TILES[e]=="undefined"||typeof TILES[e][k.x]=="undefined"||typeof TILES[e][k.x][k.y]=="undefined"){return null}return[STATIC_URL,"tiles/acanohayluz-",e,"-",k.x,"-",k.y,".png?",TILES[e][k.x][k.y]].join("")},tileSize:new google.maps.Size(g,g)});map.overlayMapTypes.push(f)}for(var b in ZONAS){ZONAS[b].overlay=new NombreBarrioOverlay(map,ZONAS[b])}}var markers_timeout=null;var markers_visible=false;function hide_markers(){if(!markers_visible){return}markers_visible=false;for(var b in markers){for(var a in markers[b]){if(typeof markers[b][a]._marker=="object"){markers[b][a]._marker.setVisible(false)}}}}function show_markers(){if(markers_visible){return}markers_visible=true;for(var b in markers){for(var a in markers[b]){if(typeof markers[b][a]._marker=="object"){markers[b][a]._marker.setVisible(true)}}}}function update_markers(e){if(map.zoom<MIN_ZOOM_MARKERS){return}var g=13;var f=get_tiles_visibles(g);for(var b in f){var a=f[b].z+"_"+f[b].x+"_"+f[b].y;if(typeof TILES[f[b].z][f[b].x][f[b].y]=="undefined"){continue}if(typeof markers[a]!="undefined"){continue}var h="acanohayluz_cache_reportes_"+f[b].z+"_"+f[b].x+"_"+f[b].y;var d=document.getElementById(h);if(d!=null){continue}var c=document.createElement("script");c.id=h;c.setAttribute("charset","utf-8");c.setAttribute("async","true");if(e){c.setAttribute("src",STATIC_URL+"reportes/reportes-"+f[b].z+"-"+f[b].x+"-"+f[b].y+"-light.js?"+session_timestamp)}else{c.setAttribute("src",STATIC_URL+"reportes/reportes-"+f[b].z+"-"+f[b].x+"-"+f[b].y+".js?"+session_timestamp)}document.body.appendChild(c)}}function acanohayluz_cache_reportes(b,a){if(typeof markers[b]=="undefined"){markers[b]=a;mostrar_markers(b)}}var last_marker_gc_pass=0;function garbage_collector_markers(){var h=13;var b=(new Date()*1)/1000/5;if(last_marker_gc_pass==b){return}last_marker_gc_pass=b;var a=get_tiles_visibles(h);var e=[];for(var f in a){e.push(a[f].z+"_"+a[f].x+"_"+a[f].y)}var d=[];for(var f in markers){d.push(f)}if(d.length>e.length*2){var j={};for(var f in d){if(!$.inArray(d[f],e)){j[d[f]]}}var g=d.length-e.length*2;for(var f in j){if(typeof markers[j[f]]=="undefined"){continue}for(var c in markers[j[f]]){if(typeof markers[j[f]][c]._marker!="undefined"){markers[j[f]][c]._marker.setMap(null)}}delete markers[j[f]];g--;if(g<=0){break}}}}setInterval(function(){garbage_collector_markers()},6000);function mostrar_markers(a){if(typeof markers[a]=="undefined"){return}var f=5;var e=markers[a].length;var d=Math.ceil(e/f);var c=0;for(var b=0;b<d;b++){setTimeout("mostrar_chunk_markers('"+a+"', "+b+", "+f+");",(1/60)*2*b)}}function mostrar_chunk_markers(a,c,d){for(var b=c*d;b<(c+1)*d;b++){if(typeof markers[a][b]=="undefined"){break}if(typeof markers[a][b]._marker!="undefined"){continue}markers[a][b]._marker=new google.maps.Marker({position:(new google.maps.LatLng(markers[a][b]["lat"],markers[a][b]["long"])),map:map,visible:(map.zoom>=MIN_ZOOM_MARKERS)?true:false,icon:{url:STATIC_URL+"css/images/reporte-"+markers[a][b]["estado"]+".png",animation:google.maps.Animation.DROP,size:new google.maps.Size(35,53),scaledSize:new google.maps.Size(18,27),anchor:new google.maps.Point(9,27),origin:new google.maps.Point(0,0)}});markers[a][b]._marker.reporte_=markers[a][b];google.maps.event.addListener(markers[a][b]._marker,"click",function(){mostrar_tooltip_reporte(this)})}}function mostrar_tooltip_reporte(b){var c="";var a=new Date(parseInt(b.reporte_.fecha.slice(0,4).ltrim("0")),parseInt(b.reporte_.fecha.slice(5,7).ltrim("0"))-1,parseInt(b.reporte_.fecha.slice(8,10).ltrim("0")),parseInt(b.reporte_.fecha.slice(11,13).ltrim("0")),parseInt(b.reporte_.fecha.slice(14,16).ltrim("0")),parseInt(b.reporte_.fecha.slice(17,19).ltrim("0")));var d=new Date(a.getTime());if(b.reporte_.estado=="hay-luz"){c+='<h6 class="'+b.reporte_.estado+'">¡Volvió la luz!</h6>'}else{if(b.reporte_.estado=="corte-amplio"){c+='<h6 class="'+b.reporte_.estado+'">Apagón en varias cuadras</h6>'}else{c+='<h6 class="'+b.reporte_.estado+'">Corte de luz</h6>'}if(typeof parseInt(b.reporte_.horas)=="number"){d.setHours(a.getHours()-parseInt(b.reporte_.horas))}}var e=Math.round(((new Date()*1)-(a.getTime()))/1000/(60*60));if(e>1){if(b.reporte_.estado=="hay-luz"){c+="<p>Hace "+Math.ceil(e)+" horas</p>"}else{c+="<p>Sin luz hace "+Math.ceil(e)+" horas</p>"}}else{if(e==1){if(b.reporte_.estado=="hay-luz"){c+="<p>Hace "+Math.ceil(e)+" hora</p>"}else{c+="<p>Sin luz hace "+Math.ceil(e)+" hora</p>"}}else{if(b.reporte_.estado=="hay-luz"){c+="<p>Hace unos minutos</p>"}else{c+="<p>Sin luz hace unos minutos</p>"}}}c+="<small>Reportado el "+pad(a.getDate(),2,"0",STR_PAD_LEFT)+"/"+pad(a.getMonth()+1,2,"0",STR_PAD_LEFT)+"/"+a.getFullYear()+" a las "+pad(a.getHours(),2,"0",STR_PAD_LEFT)+":"+pad(a.getMinutes(),2,"0",STR_PAD_LEFT)+"</small>";markerTooltip.setContent(c);markerTooltip.open(map,b)}var NombreBarrioOverlay;NombreBarrioOverlay.prototype=new google.maps.OverlayView();function NombreBarrioOverlay(b,a){this.bounds_=a.bounds;this.nombre_=a.nombre;this.slug_=a.slug;this.estado_=a.estado;this.nombre_estado_=a.estado_nombre;this.civilizacion_=a.civilizacion;this.div_=null;this.setMap(b)}NombreBarrioOverlay.prototype.onAdd=function(){var d=document.createElement("div");d.style.borderStyle="none";d.style.borderWidth="0px";d.style.position="absolute";var a="<h6>"+this.nombre_;var c="map-barrio "+this.slug_+" "+this.estado_;a+="<small>"+this.nombre_estado_+"</small>";a+="</h6>";d.className=c;d.innerHTML=a;this.div_=d;var b=this.getPanes();b.overlayLayer.appendChild(d)};NombreBarrioOverlay.prototype.draw=function(){var b=this.getProjection();var a=b.fromLatLngToDivPixel(new google.maps.LatLng(this.bounds_.sw[1],this.bounds_.sw[0]));var c=b.fromLatLngToDivPixel(new google.maps.LatLng(this.bounds_.ne[1],this.bounds_.ne[0]));var d=this.div_;d.style.left=a.x+"px";d.style.top=c.y+"px";d.style.width=(c.x-a.x)+"px";d.style.height=(a.y-c.y)+"px"};NombreBarrioOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_);this.div_=null};function mobile_setup(){setTimeout(function(){window.scrollTo(0,1)},1000);setup_autocomplete();setup_form();setup_mobile_ui()}function desktop_setup(){setup_autocomplete();setup_form();init_mapa()}function setup_mobile_ui(){$("#navegacion .boton-mapa").bind("touchstart click",function(b){b.preventDefault();a("mapa")});$("#navegacion .boton-reportar").bind("touchstart click",function(b){b.preventDefault();a("reportar")});function a(b){if($("#container").hasClass(b)){return}$("#container").attr("class","").addClass(b);if(b=="mapa"){$("#navegacion .boton-mapa").hide();$("#navegacion .boton-reportar").show();setTimeout(function(){init_mapa()},500)}else{$("#navegacion .boton-reportar").hide();$("#navegacion .boton-mapa").show()}}$(window).resize(function(){$("#mapa").height($(window).height()-83)}).trigger("resize")}$(document).ready(function(){if($("html").hasClass("shitty-browser")){$("#reportar").hide();$("body").append('<div id="aviso-shitty-browser">Tu navegador está <strong>desactualizado</strong>. Tiene más de 5 años, es lento y te causa problemas con la mayor parte de la web. <br/><br/>Tomate 2 minutos para poner Google Chrome, <strong>el mejor navegador gratuito</strong>: <strong><a href="https://www.google.com/intl/es/chrome/browser/?hl=es" target="_blank">Actualizate a Google Chrome</a></strong></div>')}if(is_mobile()){mobile_setup()}else{desktop_setup()}});